{% extends "base.html" %}
{% block title %}Список постов сайта{% endblock title %}
{% block content %}

<div class="container mt-4">
    <h1 class="display-4 fw-bold mb-4">Список проектов</h1>

    {% for Project in Projects %}
        <div class="card mb-4 shadow-sm border-0">
            <div class="card-header bg-light py-3">
                <div class="d-flex justify-content-between align-items-center">
                    <h2 class="card-title h5 mb-0">
                        <a href="{% url 'mainpage:post_detail' Project.id %}" class="text-decoration-none text-dark fw-bold">
                            {{ Project.title }}
                        </a>
                    </h2>
                    <small class="text-muted">
                        <i class="far fa-calendar me-1"></i>
                        {{ Project.created_at|date:'d.m.Y H:i' }}
                    </small>
                </div>
            </div>
            
            <div class="card-body">
                <p class="card-text text-secondary mb-3">{{ Project.text }}</p>
                
                {% if Project.file.all %}
                    {% comment %} <h6 class="text-muted mb-3">
                        <i class="far fa-file me-1"></i>
                        Файлы проекта ({{ Project.file.all|length }}):
                    </h6> {% endcomment %}
                    
                    <div id="carouselExampleIndicators{{Project.id}}" class="carousel slide" data-bs-ride="carousel">

                        <div class="carousel-indicators">
                            {% for file in Project.file.all%}   
                            
                                <button type="button" data-bs-target="#carouselExampleIndicators{{Project.id}}" data-bs-slide-to="{{ forloop.counter0 }}" aria-label="Slide {{forloop.counter0}}" class="{%if forloop.first%}active{% endif %}" aria-label="Slide {{ forloop.counter0 }}"></button>
                            {% endfor %}
                        </div>

                        <div class="carousel-inner">

                            {% for file in Project.file.all %}
                                <div class="carousel-item {%if forloop.first%}active{% endif %}" style="aspect-ratio: 16/9"> 
                                            <!-- Определяем тип файла для отображения -->
                                    {% with file_extension=file.file.url|lower|slice:'-4:' %}
                                        {% if file_extension == '.jpg' or file_extension == '.png' or file_extension == '.gif' or file.file.url|lower|slice:'-5:' == '.jpeg' %}
                                            {% comment %} <div class="text-center mb-2 overflow-hidden" style="aspect-ratio: 16/9"> {% endcomment %}
                                                {% comment %} <img src="{{ file.file.url }}" alt="{{ file.name }}" class="d-block w-100" > {% endcomment %}
                                                <img src="{{ file.file.url }}" alt="{{ file.name }}" class="w-100 h-100 object-fit-cover object-position-center" >
                                            {% comment %} </div> {% endcomment %}
                                        {% else %}
                                            <div class="text-center mb-2">
                                                <i class="far fa-file-alt fa-3x text-secondary"></i>
                                            </div>
                                        {% endif %}
                                    {% endwith %}


                                    <div class="position-absolute bottom-0 start-0 end-0 p-3" style="background: rgba(0,0,0,0.5);">
                                        <h6 class="card-title text-white text-truncate mb-0">{{ file.name }}</h6>
                                        {% if file.text %}
                                            <p class="card-text small text-light">{{ file.text|truncatewords:15 }}</p>
                                        {% endif %}
                                    </div>




{% comment %} 
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <h6 class="card-title text-truncate mb-0" title="{{ file.name }}">
                                            {{ file.name }}
                                        </h6>
                                    </div>
                                    
                                    {% if file.text %}
                                        <p class="card-text small text-muted flex-grow-1">
                                            {{ file.text|truncatewords:15 }}
                                        </p>
                                    {% endif %} {% endcomment %}




                                    {% comment %} <div class="mt-auto">
                                        <a href="{{ file.file.url }}" 
                                            class="btn btn-outline-primary btn-sm w-100" 
                                            download 
                                            target="_blank">
                                            <i class="fas fa-download me-1"></i>
                                            Скачать
                                        </a>
                                    </div> {% endcomment %}
                                        
                                </div>
                            {% endfor %}

                        </div>
                        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators{{Project.id}}" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Previous</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators{{Project.id}}" data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Next</span>
                        </button>
                    </div>
                {% else %}
                    <div class="alert alert-info d-flex align-items-center" role="alert">
                        <i class="far fa-folder-open me-2"></i>
                        У этого проекта пока нет файлов
                    </div>
                {% endif %}
                
                {% comment %} <div class="mt-3 pt-3 border-top">
                    <div class="d-flex justify-content-between align-items-center">
                        <small class="text-muted">
                            <i class="far fa-edit me-1"></i>
                            Обновлен: {{ Project.updated_at|date:'d.m.Y H:i' }}
                        </small>
                        <a href="{% url 'mainpage:post_detail' Project.id %}" 
                            class="btn btn-primary btn-sm">
                            <i class="far fa-eye me-1"></i>
                            Подробнее
                        </a>
                    </div>
                </div> {% endcomment %}
            </div>
        </div>
    {% empty %}
        <div class="text-center py-5">
            <i class="far fa-folder-open fa-3x text-secondary mb-3"></i>
            <h3 class="text-muted">Проектов еще нет</h3>
            <p class="text-muted">Здесь появятся проекты, когда они будут добавлены</p>
        </div>
    {% endfor %}
</div>

<!-- Подключение Font Awesome для иконок -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">



{% comment %} 


<div class="container mt-4">
    <h1 class="mb-4">Список постов сайта</h1>

    {% for Project in Projects %}
        <div class="card mb-3">
            <div class="card-body">
                <h2 class="card-title h5">Заголовок проекта: <a href="{% url "mainpage:post_detail" Project.id %}" class="text-decoration-none">{{ Project.title }}</a></h2>
                <p class="card-text">Текст проекта: {{ Project.text }}</p>
                <small class="text-muted">Дата создания: {{ Project.created_at|date:'d.m.Y H:i' }}</small>
                {% for file in Project.file.all %}
                <div class="col-md-4 mb-3">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="card-title">{{ file.name }}</h6>
                                    <p class="card-text">{{ file.text }}</p>
                                    
                                    <!-- Определяем тип файла для отображения -->
                                    {% with file_extension=file.file.url|lower|slice:'-4:' %}
                                    {% if file_extension == '.jpg' or file_extension == '.png' or file_extension == '.gif' or file.file.url|lower|slice:'-5:' == '.jpeg' %}
                                        <img src="{{ file.file.url }}" alt="{{ file.name }}" class="img-fluid mb-2" style="max-height: 150px;">
                                        <br>
                                    {% endif %}
                                    {% endwith %}
                                    
                                    <a href="{{ file.file.url }}" class="btn btn-sm btn-outline-primary" download target="_blank">
                                        Скачать файл
                                    </a>
                                </div>
                            </div>
                        </div>
                {% endfor %}               
            </div>
        </div>
    
    {% empty %}
        <div class="alert alert-info" role="alert">
            Проектов еще нет.
        </div>
    {% endfor %}
</div>{% endcomment %}
{% endblock content %} 
